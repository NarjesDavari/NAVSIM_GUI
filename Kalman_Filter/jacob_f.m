%Computation of the jacobians of dynamic model function(f)
%Reference: My thesis page 80-84
function F=jacob_f(x,dt)

    %x=[Lat,lon,h,Vn,Ve,Vd,fn,fe,fd,phi,theta,psi,Wx,Wy,Wz]:15x1(N=15)

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    %Constant Parameters
    R=6378137;
    Omega=7.292115e-05;
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
    k1=1/(R+x(3));
    k2=sec(x(1));
    k3=tan(x(1));
    k4=cos(x(1));
    k5=1+k3^2;
    k6=sin(x(1));
    
        Wie=Omega;
        F=[1,0,dt*x(4)*(-k1^2),dt*k1,0,0,0,0,0,0,0,0,0,0,0;
           dt*x(5)*k1*k2*k3,1,dt*x(5)*-k2*k1^2,0,dt*k2*k1,0,0,0,0,0,0,0,0,0,0;
           0,0,1,0,0,-dt,0,0,0,0,0,0,0,0,0;
       
           dt*(-2*Wie*x(5)*k4-x(5)^2*k1*k5),0,-dt*k1^2*(x(4)*x(6)-x(5)^2*k3),1+dt*x(6)*k1,dt*(-2*Wie*k6-2*x(5)*k3*k1),dt*x(4)*k1,dt,0,0,0,0,0,0,0,0;       
           dt*(2*Wie*(x(4)*k4-x(6)*k6)+x(4)*x(5)*k1*k5),0,-dt*x(5)*k1^2*(x(6)+x(4)*k3),dt*(2*Wie*k6+x(5)*k3*k1),1+dt*k1*(x(6)+x(4)*k3),dt*(2*Wie*k4+x(5)*k1),0,dt,0,0,0,0,0,0,0;       
           dt*2*Wie*x(5)*k6,0,dt*k1^2*(x(4)^2+x(5)^2),-dt*2*x(4)*k1,-dt*(2*Wie*k4+2*x(5)*k1),1,0,0,dt,0,0,0,0,0,0; 
       
           0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;       
           0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;       
           0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;
       
           0,0,0,0,0,0,0,0,0,1+dt*((x(14)*cos(x(10))-x(15)*sin(x(10)))*tan(x(11))),dt*(x(14)*sin(x(10))+x(15)*cos(x(10)))*(1+(tan(x(11)))^2),0,dt,dt*sin(x(10))*tan(x(11)),dt*cos(x(10))*tan(x(11));    
           0,0,0,0,0,0,0,0,0,dt*(-x(14)*sin(x(10))-x(15)*cos(x(10))),1,0,0,dt*cos(x(10)),-dt*sin(x(10));
           0,0,0,0,0,0,0,0,0,dt*sec(x(11))*(x(14)*cos(x(10))-x(15)*sin(x(10))),dt*sec(x(11))*tan(x(11))*(x(14)*sin(x(10))+x(15)*cos(x(10))),1,0,dt*sin(x(10))*sec(x(11)),dt*cos(x(10))*sec(x(11));
       
           0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;       
           0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;       
           0,0,0,0,0,0,0,0,0,0,0,0,0,0,0;       
           ];        
    